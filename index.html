<script>
async function downloadVideo() {
  const url = document.getElementById("videoURL").value.trim();
  const msg = document.getElementById("msg");

  if (!url) {
    msg.innerText = "Masukkan URL terlebih dahulu.";
    msg.style.color = "red";
    return;
  }

  msg.innerText = "Mencari video di halaman...";
  msg.style.color = "orange";

  try {
    // Ambil isi halaman
    const res = await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(url));
    const text = await res.text();

    // Cari tag <video> atau source
    const match = text.match(/src=["']([^"']+\.(mp4|webm|mkv|mov|ogg|ts|m3u8)[^"']*)["']/i);

    if (!match) {
      msg.innerText = "Video tidak ditemukan atau situs dilindungi.";
      msg.style.color = "red";
      return;
    }

    const videoURL = match[1];

    msg.innerText = "Video ditemukan! Mengunduh...";
    msg.style.color = "green";

    // Nama file otomatis
    const fileName = videoURL.split('/').pop().split('?')[0];

    const a = document.createElement("a");
    a.href = videoURL;
    a.download = fileName;
    a.click();

  } catch (e) {
    msg.innerText = "Gagal mengambil video.";
    msg.style.color = "red";
  }
}
</script>
